<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>CEDiLのデータを取得する</title>
<link rel="stylesheet" href="./impl/lib/jquery-ui-1.12.0/themes/smoothness/jquery-ui.min.css" />
<link rel="stylesheet" href="./impl/lib/jquery-ui-1.12.0/themes/smoothness/theme.css" />
<link rel="stylesheet" href="./main.css" />

<script src="impl/lib/jquery-2.1.4.min.js"></script>
<script src="impl/lib/jquery-ui-1.12.0/jquery-ui.min.js"></script>
<script src="impl/lib/jquery.xdomainajax.js"></script>
</head>

<body>
	<div id="contents">
		<select id="select_year">
		</select>
		<input type="button" value="JSONファイル作成" />

		<div id="log"></div>
	</div>

<script src="impl/cedec.js"></script>
<script src="impl/cedil.js"></script>

<script type="text/javascript">
$(document).ready(function(){

	// select文作成
	var year_options    = [];
	var now      = new Date();
	var now_year = now.getFullYear();

	// 適当に5年前くらいまでしか作成出来ないように
	for( var i = 0 ; i < 3  ; ++i ){
		year_options.push( '<option>' + (now_year - i) + '</option>' );
	}
	$('#select_year').append( year_options );

	$('#log').empty();

	$('input').click(function(){

		var year    = $(this).prev().val();
		var setting = CEDEC.createSettingFromYear( year );

		if( setting.cedil_tag_no === undefined ){
			alert( "CEDiLのタグIDが未登録です。" );
			return;
		}

		CEDiL.writeJsonData( year, setting.cedil_tag_no, success, end );


		function success(list){
			var $log = $('#log');
			
			for( var i = 0 ; i < list.length ; ++i ){
				var s = list[i];
				var text = '<a href="' + s.url + '">' + s.title + '</a><br/>';
				$log.prepend( text );
			}
		}

		function end(list){
			var $log = $('#log');
			$log.prepend( "<hr/>" );
			$log.prepend( list.length + "件のデータを作成<br/>" );
		}
	});

});
</script>
</body>
</html>
